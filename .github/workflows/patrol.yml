name: ğŸ“ Project Okido Patrol

on:
  schedule:
    # 1æ™‚é–“ãŠãã«ãƒã‚µãƒ©ã‚¿ã‚¦ãƒ³ã‚’å‡ºç™ºã™ã‚‹ãã„ (UTCåŸºæº–ãªã®ã§ 0åˆ†ã«å®Ÿè¡Œ)
    - cron: '0 * * * *'
  workflow_dispatch:
    # æ‰‹å‹•ã§ã€Œã„ã‘ï¼ã‚ªãƒ¼ã‚­ãƒ‰ï¼ã€ã¨æŒ‡ç¤ºã‚’å‡ºã™ã“ã¨ã‚‚å¯èƒ½ã˜ã‚ƒ
    inputs:
      reason:
        description: 'æ‰‹å‹•ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«ã®ç†ç”±'
        required: false
        default: 'ç·Šæ€¥èª¿æŸ»'

jobs:
  patrol:
    runs-on: ubuntu-latest
    # å±¥æ­´ã‚’æ›¸ãè¾¼ã‚€ãŸã‚ã«æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä¸ãˆã‚‹ã®ã˜ã‚ƒ
    permissions:
      contents: write

    steps:
      - name: ğŸ›°ï¸ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ Pythonç’°å¢ƒã®æ§‹ç¯‰ (3.11)
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip' # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦çˆ†é€Ÿã«ã™ã‚‹ãã„

      - name: ğŸ“¦ ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸ•µï¸ ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«é–‹å§‹
        env:
          # GitHubã®Secretã«ç™»éŒ²ã—ãŸéµã‚’ç’°å¢ƒå¤‰æ•°ã«æµã—è¾¼ã‚€ã®ã˜ã‚ƒï¼
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_TOKEN_SECRET: ${{ secrets.X_ACCESS_TOKEN_SECRET }}
          RAPIDAPI_KEY: ${{ secrets.RAPIDAPI_KEY }}
        run: python main.py

      - name: ğŸ“ èª¿æŸ»å ±å‘Šæ›¸ã®ä¿å­˜ (å±¥æ­´ã®è‡ªå‹•Push)
        run: |
          git config --global user.name "Okido-Bot-Assistant"
          git config --global user.email "bot@okido-lab.example.com"
          git add replied_tweets.txt
          # å±¥æ­´ãŒæ›´æ–°ã•ã‚ŒãŸæ™‚ã ã‘ã‚³ãƒŸãƒƒãƒˆã™ã‚‹è³¢ã„ãƒ­ã‚¸ãƒƒã‚¯ã˜ã‚ƒ
          git diff --quiet && git diff --staged --quiet || (git commit -m "chore: èª¿æŸ»å ±å‘Šæ›¸(å±¥æ­´)ã‚’æ›´æ–°ã—ã¾ã—ãŸ [skip ci]" && git push)